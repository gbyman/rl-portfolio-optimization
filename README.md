# rl-portfolio-optimization: SOXL & JEPQ
ê°•í™”í•™ìŠµ(PPO)ì„ í™œìš©í•˜ì—¬ ê³ ë³€ë™ì„± ìì‚°(SOXL)ê³¼ ê³ ë°°ë‹¹ ìì‚°(JEPQ)ì„ í˜¼í•©í•œ ìµœì ì˜ í¬íŠ¸í´ë¦¬ì˜¤ ìš´ìš© ì „ëµì„ í•™ìŠµí•˜ëŠ” í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

## Project Overview
ë³€ë™ì„±ì´ ê·¹ì‹¬í•œ **3ë°° ë ˆë²„ë¦¬ì§€ ETF(SOXL)**ì™€ ì•ˆì •ì ì¸ **ì»¤ë²„ë“œì½œ ETF(JEPQ)**ë¥¼ ê²°í•©í•˜ì—¬, í•˜ë½ì¥ ë°©ì–´ì™€ ìˆ˜ìµë¥  ê·¹ëŒ€í™”ë¥¼ ë™ì‹œì— ì¶”êµ¬í•˜ëŠ” AI ì—ì´ì „íŠ¸ë¥¼ ê°œë°œí•˜ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•©ë‹ˆë‹¤.

###  í”„ë¡œì íŠ¸ í•µì‹¬ëª©í¬
1. **Human Rule vs AI:** ì¸ê°„ì˜ ì§ê´€ì  ì „ëµ(1í‘œì¤€í¸ì°¨ í™œìš©, ë¦¬ë°¸ëŸ°ì‹±)ì„ AIê°€ í•™ìŠµì„ í†µí•´ ë„˜ì–´ì„¤ ìˆ˜ ìˆëŠ”ì§€ ê²€ì¦í•©ë‹ˆë‹¤.
2. **í˜„ì‹¤ì ì¸ í™˜ê²½ êµ¬ì¶•:** ì›” ì ë¦½ì‹ íˆ¬ì, ë°°ë‹¹ê¸ˆ ì¬íˆ¬ì ë“± ì‹¤ì œ íˆ¬ì ì‹œë‚˜ë¦¬ì˜¤ë¥¼ í™˜ê²½(Env)ì— êµ¬í˜„í•©ë‹ˆë‹¤.(ê±°ë˜ ìˆ˜ìˆ˜ë£Œ ë° ì„¸ê¸ˆ ì œì™¸)
3. **ë³€ë™ì„± ëŒ€ì‘:** ì£¼ê°€ì˜ ë‹¨ìˆœ ë“±ë½ì´ ì•„ë‹Œ, í†µê³„ì  ì§€í‘œ(Z-Score)ë¥¼ í•™ìŠµì‹œì¼œ ë³€ë™ì„± êµ­ë©´ì—ì„œì˜ ëŒ€ì‘ ëŠ¥ë ¥ì„ ì‹¤í—˜í•©ë‹ˆë‹¤.

## ê¸°ìˆ  ìŠ¤íƒ
* **Language:** Python 3.10+
* **RL Library:** Stable Baselines3 (PPO), Gymnasium
* **Data Source:** `yfinance` (Yahoo Finance API)
* **Analysis:** Pandas, Matplotlib, NumPy

## ê°•í™”í•™ìŠµ í™˜ê²½ ì„¤ê³„ (MDP)
AI ì—ì´ì „íŠ¸ëŠ” 'Gymnasium' ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ êµ¬ì¶•ëœ ì»¤ìŠ¤í…€ í™˜ê²½ì—ì„œ ìƒí˜¸ì‘ìš©í•˜ë©° í•™ìŠµí•©ë‹ˆë‹¤.

### ìƒíƒœ (Observation Space)
ì—ì´ì „íŠ¸ëŠ” ì´ 9ê°œì˜ ì°¨ì›ì„ í†µí•´ ì‹œì¥ê³¼ í¬íŠ¸í´ë¦¬ì˜¤ ìƒíƒœë¥¼ ê´€ì°°í•©ë‹ˆë‹¤.
* **Portfolio Info:** í˜„ê¸ˆ ì”ê³ , ì¢…ëª©ë³„ ë³´ìœ  ìˆ˜ëŸ‰(SOXL, JEPQ), í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ ê°€ì¹˜, SOXL ìˆ˜ìµë¥ 
* **Market Data:** ì¢…ëª©ë³„ í˜„ì¬ê°€, **Z-Score(20ì¼ ì´ë™í‰ê·  ëŒ€ë¹„ ì´ê²©ë„)**, RSI

### í–‰ë™ (Action Space)
ì—ì´ì „íŠ¸ëŠ” 5ê°€ì§€ ì´ì‚°ì  í–‰ë™(Discrete Actions) ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
* `0`: **Hold** ê´€ë§ (ìë™ ì ë¦½ ë° ë°°ë‹¹ ì¬íˆ¬ìëŠ” ë°±ê·¸ë¼ìš´ë“œ ìˆ˜í–‰)
* `1`: **Buy SOXL** ê³ ì • ê¸ˆì•¡ $1,000 ë§¤ìˆ˜
* `2`: **Rebalance Weak** SOXL 10% ë§¤ë„ â†’ JEPQ ì „í™˜ (ì•½í•œ ë¦¬ë°¸ëŸ°ì‹±)
* `3`: **Rebalance Strong** SOXL 50% ë§¤ë„ â†’ JEPQ ì „í™˜ (ìœ„ê¸° ëŒ€ì‘)
* `4`: **Aggressive Switch** JEPQ 10% ë§¤ë„ â†’ SOXL ë§¤ìˆ˜ (ê³µê²©ì  íˆ¬ì ì „í™˜)

### ë³´ìƒ (Reward Function)
* **ê¸°ë³¸ ë³´ìƒ:** í¬íŠ¸í´ë¦¬ì˜¤ì˜ ì¼ì¼ ê°€ì¹˜ ë³€ë™ë¥ (Log Return)ì„ ì‚¬ìš©í•˜ì—¬ ìì‚° ì¦ì‹ì„ ìœ ë„í•©ë‹ˆë‹¤.
* **Penalty:** ì¦ì€ ê±°ë˜ ë°©ì§€ë¥¼ ìœ„í•œ ê±°ë˜ ë¹„ìš© ë°˜ì˜ (Optional)

## ì‹¤í–‰ ë°©ë²•
ë³¸ í”„ë¡œì íŠ¸ëŠ” í•™ìŠµ ì†ë„ì™€ ë¼ì´ë¸ŒëŸ¬ë¦¬ í˜¸í™˜ì„±ì„ ìœ„í•´ **Google Colab** í™˜ê²½ì— ìµœì í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë³„ë„ì˜ ì„¤ì¹˜ ê³¼ì • ì—†ì´ ì•„ë˜ ë°°ì§€ë¥¼ í´ë¦­í•˜ì—¬ ë°”ë¡œ ì‹¤í–‰í•´ ë³´ì‹œëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.
Colabì—ì„œ ì‹¤í–‰ì‹œ ì‹œê°í™”ê¹Œì§€ 2ë¶„~3ë¶„ ì •ë„ì˜ ì‹œê°„ì´ ê±¸ë¦½ë‹ˆë‹¤.

### 1. Google Colabì—ì„œ ë°”ë¡œ ì‹¤í–‰í•˜ê¸° (ê¶Œì¥)
ì•„ë˜ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ Google Colabì—ì„œ ì†ŒìŠ¤ ì½”ë“œë¥¼ ë°”ë¡œ ì—´ê³  ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/gbyman/rl-portfolio-optimization/blob/main/main.ipynb)

1. ìœ„ ë°°ì§€ë¥¼ í´ë¦­í•©ë‹ˆë‹¤.
2. Colab ìƒë‹¨ ë©”ë‰´ì—ì„œ **[ëŸ°íƒ€ì„]** > **[ëª¨ë‘ ì‹¤í–‰]**ì„ í´ë¦­í•˜ë©´ ë°ì´í„° ë‹¤ìš´ë¡œë“œë¶€í„° í•™ìŠµ, ì‹œê°í™”ê¹Œì§€ ìë™ìœ¼ë¡œ ì§„í–‰ë©ë‹ˆë‹¤.
   *(GPU ëŸ°íƒ€ì„ì„ ì‚¬ìš©í•˜ì‹œë©´ í•™ìŠµ ì†ë„ê°€ ë” ë¹ ë¦…ë‹ˆë‹¤)*

---

### 2. ë¡œì»¬ í™˜ê²½ì—ì„œ ì‹¤í–‰í•˜ê¸°
ë¡œì»¬ì—ì„œ ì‹¤í–‰í•˜ì‹¤ ê²½ìš° Python 3.10 ì´ìƒì˜ í™˜ê²½ì´ í•„ìš”í•©ë‹ˆë‹¤.

**Step 1. ì €ì¥ì†Œ í´ë¡  ë° ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜**
```bash
git clone [https://github.com/gbyman/rl-portfolio-optimization.git](https://github.com/gbyman/rl-portfolio-optimization.git)
cd rl-portfolio-optimization
pip install -r requirements.txt
```

## ì‹¤í—˜ ê²°ê³¼ (Experiment Results)

### 1. ì„±ê³¼ ë¹„êµ ê·¸ë˜í”„ (Performance Comparison)
ì•„ë˜ ê·¸ë˜í”„ëŠ” í•™ìŠµëœ **AI ì—ì´ì „íŠ¸**, **Rule-based ì „ëµ**, ê·¸ë¦¬ê³  **Benchmark(SPY)**ì˜ 3ë…„ê°„ ëˆ„ì  ìˆ˜ìµë¥  ì¶”ì´ë¥¼ ë¹„êµí•œ ê²°ê³¼ì…ë‹ˆë‹¤.

<p align="center">
  <img src="./assets/rl-result.png" alt="Performance Graph" width="800">
</p>

> **ê·¸ë˜í”„ í•´ì„:**
> * ğŸ”´ **AI Agent (Red):** ê°€ì¥ ë†’ì€ ìµœì¢… ìˆ˜ìµë¥ ì„ ê¸°ë¡í–ˆìœ¼ë‚˜, í•˜ë½ì¥ì—ì„œ ë³€ë™ì„±(MDD) ê´€ë¦¬ê°€ ë˜ì§€ ì•Šì•„ ê·¸ë˜í”„ì˜ ë“±ë½í­ì´ ë§¤ìš° í½ë‹ˆë‹¤.
> * ğŸ”µ **Rule-based (Blue):** ìš°ìƒí–¥í•˜ëŠ” ì•ˆì •ì ì¸ ì¶”ì„¸ë¥¼ ë³´ì´ë©°, í•˜ë½ì¥ì—ì„œë„ ìì‚° ê°€ì¹˜ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ ë°©ì–´(Flat)í•˜ëŠ” ëª¨ìŠµì´ ê´€ì°°ë©ë‹ˆë‹¤.
> * ğŸŸ¢ **Benchmark (Green):** ì‹œì¥ ì§€ìˆ˜(SPY)ë¥¼ ë‹¨ìˆœ ì¶”ì¢…í•˜ë©°, ë ˆë²„ë¦¬ì§€ ì „ëµë“¤ì— ë¹„í•´ ìˆ˜ìµë¥ ì´ ë‚®ìŠµë‹ˆë‹¤.

### 2. ì„±ê³¼ ì§€í‘œ ìš”ì•½ (Summary Table)
| Strategy | Return (%) | Sharpe Ratio | MDD (%) |
|----------|:----------:|:------------:|:-------:|
| **AI Agent (PPO)** | **244.26%** | 0.9106 | -83.71% |
| **Rule-based** | 228.92% | **2.0730** | **-18.79%** |
| **Benchmark (SPY)** | 80.78% | 1.3396 | -18.76% |
